Description: port test items from nose to pytest.
Author: Ã‰tienne Mollier <emolier@debian.org>
Bug: https://github.com/njsmith/colorspacious/issues/25
Last-Update: 2024-03-16
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- colorspacious.orig/colorspacious/ciecam02.py
+++ colorspacious/colorspacious/ciecam02.py
@@ -472,40 +472,38 @@
                         check_roundtrip(vc, XYZ100)
 
 def test_misc():
-    from nose.tools import assert_raises
+    from pytest import raises
     # Only one whitepoint can be specified
-    assert_raises(ValueError, CIECAM02Space,
-                  [[20, 100, 80], [80, 100, 20]], 20, 30)
+    with raises(ValueError):
+        CIECAM02Space([[20, 100, 80], [80, 100, 20]], 20, 30)
 
     # smoke test
     repr(CIECAM02Space.sRGB)
     repr(CIECAM02Space("D65", 20, 4, surround=CIECAM02Surround.DIM))
 
-    # input shape check
-    assert_raises(ValueError,
-                  CIECAM02Space.sRGB.XYZ100_to_CIECAM02,
-                  np.ones((10, 4)))
-
-    # on_negative_A validity check
-    assert_raises(ValueError,
-                  CIECAM02Space.sRGB.XYZ100_to_CIECAM02,
-                  np.ones((10, 3)),
-                  on_negative_A="asdfasdf")
+    with raises(ValueError):
+        # input shape check
+        CIECAM02Space.sRGB.XYZ100_to_CIECAM02(np.ones((10, 4)))
+
+        # on_negative_A validity check
+        CIECAM02Space.sRGB.XYZ100_to_CIECAM02(np.ones((10, 3)),
+                                              on_negative_A="asdfasdf")
 
 def test_exactly_one():
-    from nose.tools import assert_raises
+    from pytest import raises
     vc = CIECAM02Space.sRGB
 
-    # Redundant specifications not allowed
-    assert_raises(ValueError, vc.CIECAM02_to_XYZ100, J=1, C=1, h=1, Q=1)
-    assert_raises(ValueError, vc.CIECAM02_to_XYZ100, J=1, C=1, h=1, M=1)
-    assert_raises(ValueError, vc.CIECAM02_to_XYZ100, J=1, C=1, h=1, s=1)
-    assert_raises(ValueError, vc.CIECAM02_to_XYZ100, J=1, C=1, h=1, H=1)
-
-    # Underspecified colors not allowed either
-    assert_raises(ValueError, vc.CIECAM02_to_XYZ100, J=1, C=1)
-    assert_raises(ValueError, vc.CIECAM02_to_XYZ100, J=1, h=1)
-    assert_raises(ValueError, vc.CIECAM02_to_XYZ100, C=1, h=1)
+    with raises(ValueError):
+        # Redundant specifications not allowed
+        vc.CIECAM02_to_XYZ100(J=1, C=1, h=1, Q=1)
+        vc.CIECAM02_to_XYZ100(J=1, C=1, h=1, M=1)
+        vc.CIECAM02_to_XYZ100(J=1, C=1, h=1, s=1)
+        vc.CIECAM02_to_XYZ100(J=1, C=1, h=1, H=1)
+
+        # Underspecified colors not allowed either
+        vc.CIECAM02_to_XYZ100(J=1, C=1)
+        vc.CIECAM02_to_XYZ100(J=1, h=1)
+        vc.CIECAM02_to_XYZ100(C=1, h=1)
 
 def test_vectorized():
     vc = CIECAM02Space.sRGB
@@ -521,20 +519,17 @@
     check_roundtrip(vc, XYZ100s)
 
 def test_on_negative_A():
-    from nose.tools import assert_raises
+    from pytest import raises
 
     vc = CIECAM02Space("D65", 20, 30)
     bad_XYZ100 = [8.71292997, 2.02183974, 83.26198455]
     good_XYZ100 = [20, 30, 40]
 
-    assert_raises(NegativeAError, vc.XYZ100_to_CIECAM02, bad_XYZ100)
-    assert_raises(NegativeAError, vc.XYZ100_to_CIECAM02,
-                  [bad_XYZ100, good_XYZ100])
-    assert_raises(NegativeAError, vc.XYZ100_to_CIECAM02, bad_XYZ100,
-                  on_negative_A="raise")
-    assert_raises(NegativeAError, vc.XYZ100_to_CIECAM02,
-                  [bad_XYZ100, good_XYZ100],
-                  on_negative_A="raise")
+    with raises(NegativeAError):
+        vc.XYZ100_to_CIECAM02(bad_XYZ100)
+        vc.XYZ100_to_CIECAM02([bad_XYZ100, good_XYZ100])
+        vc.XYZ100_to_CIECAM02(bad_XYZ100, on_negative_A="raise")
+        vc.XYZ100_to_CIECAM02([bad_XYZ100, good_XYZ100], on_negative_A="raise")
 
     bad_CIECAM02 = vc.XYZ100_to_CIECAM02(bad_XYZ100, on_negative_A="nan")
     for bad_attr in "JCQMs":
--- colorspacious.orig/colorspacious/conversion.py
+++ colorspacious/colorspacious/conversion.py
@@ -370,9 +370,9 @@
     )
 
 def test_CIECAM02_subset_error_checking():
-    from nose.tools import assert_raises
-    assert_raises(ValueError,
-                  cspace_convert, np.ones((5, 4)), "JCh", "XYZ100")
+    from pytest import raises
+    with raises(ValueError):
+        cspace_convert(np.ones((5, 4)), "JCh", "XYZ100")
 
 def test_name_aliases():
     # "CAM02-UCS" is not a primitive name, but rather an alias
@@ -399,8 +399,7 @@
                         "ciecam02_space": weird_space,
                         "luoetal2006_space": CAM02UCS}))
 
-    from nose.tools import assert_raises
-    assert_raises(ValueError,
-                  cspace_convert, [1, 2, 3], "sRGB255", object())
-    assert_raises(ValueError,
-                  cspace_convert, [1, 2, 3], "sRGB255", "qwertyuiop")
+    from pytest import raises
+    with raises(ValueError):
+        cspace_convert([1, 2, 3], "sRGB255", object())
+        cspace_convert([1, 2, 3], "sRGB255", "qwertyuiop")
--- colorspacious.orig/colorspacious/illuminants.py
+++ colorspacious/colorspacious/illuminants.py
@@ -89,9 +89,9 @@
         standard_illuminant_XYZ100("D65", observer="CIE 1964 10 deg"),
         [ 94.811, 100, 107.304])
 
-    from nose.tools import assert_raises
-    assert_raises(ValueError, standard_illuminant_XYZ100, "D65",
-                  observer="something else")
+    from pytest import raises
+    with raises(ValueError):
+        standard_illuminant_XYZ100("D65", observer="something else")
 
 # Convenience function
 def as_XYZ100_w(whitepoint):
@@ -120,6 +120,8 @@
     assert np.allclose(as_XYZ100_w([1, 2, 3]), [1, 2, 3])
     assert as_XYZ100_w([1, 2, 3]).dtype == float
 
-    from nose.tools import assert_raises
-    assert_raises(KeyError, as_XYZ100_w, "D666")
-    assert_raises(ValueError, as_XYZ100_w, [1, 2, 3, 4])
+    from pytest import raises
+    with raises(KeyError):
+        as_XYZ100_w("D666")
+    with raises(ValueError):
+        as_XYZ100_w([1, 2, 3, 4])
--- colorspacious.orig/colorspacious/transform_graph.py
+++ colorspacious/colorspacious/transform_graph.py
@@ -46,13 +46,15 @@
             assert_(v in allowed_placeholders)
 
 def test_check_node():
-    from nose.tools import assert_raises
-    assert_raises(AssertionError, check_node, {}, [])
+    from pytest import raises
+    with raises(AssertionError):
+        check_node({}, [])
     check_node({"name": "asdf"}, [])
-    assert_raises(AssertionError, check_node, {"name": 1}, [])
+    with raises(AssertionError):
+        check_node({"name": 1}, [])
     check_node({"name": "asdf", "a": "b"}, [])
-    assert_raises(AssertionError, check_node,
-                  {"name": "asdf", "a": MATCH}, [ANY])
+    with raises(AssertionError):
+        check_node({"name": "asdf", "a": MATCH}, [ANY])
     check_node({"name": "asdf", "a": ANY, "b": "c"}, [ANY])
 
 # edge_node = edge node, can have MATCH or ANY or concrete values
@@ -92,7 +94,7 @@
             assert_(set([start_v, end_v]) == set([ANY, NOTHING]))
 
 def test_check_edge():
-    from nose.tools import assert_raises
+    from pytest import raises
 
     check_edge(Edge({"name": "foo"}, {"name": "bar"}, "fake transform"))
     check_edge(Edge({"name": "foo", "start_any": ANY, "match": MATCH},
@@ -110,7 +112,8 @@
             Edge({"name": "foo", "a": "asdf"}, {"name": "bar", "a": MATCH},
                  "fake transform"),
             ]:
-        assert_raises(AssertionError, check_edge, bad)
+        with raises(AssertionError):
+            check_edge(bad)
 
 def check_path(path):
     for node in path.nodes:
@@ -129,7 +132,7 @@
     assert_(len(path.nodes) == len(path.transforms) + 1)
 
 def test_check_path():
-    from nose.tools import assert_raises
+    from pytest import raises
 
     check_path(Path(({"name": "foo"}, {"name": "bar"}), ("t1",)))
     check_path(Path(({"name": "foo"},
@@ -154,7 +157,8 @@
             Path([{"name": "foo"}, {"name": "bar"}], []),
             Path([{"name": "foo"}, {"name": "bar"}], ["t1", "t2"]),
             ]:
-        assert_raises(AssertionError, check_path, bad)
+        with raises(AssertionError):
+            check_path(bad)
 
 ################################################################
 # Dict manipulation utilities
@@ -509,16 +513,15 @@
     return kwargs
 
 def test_transform_kwargs():
-    from nose.tools import assert_raises
+    from pytest import raises
 
     assert_(transform_kwargs({"name": "start"}, {"name": "end"}) == {})
     assert_(transform_kwargs(
         {"name": "start", "a": 1, "b": 2},
         {"name": "end", "b": 2, "c": 3}
         ) == {"a": 1, "b": 2, "c": 3})
-    assert_raises(AssertionError, transform_kwargs,
-                  {"name": "start", "a": 1},
-                  {"name": "end",   "a": 2})
+    with raises(AssertionError):
+        transform_kwargs({"name": "start", "a": 1}, {"name": "end",   "a": 2})
 
 def path_matches(path, desired_concrete_start, desired_concrete_end):
     # check that path[0] and path[-1] match concrete_start and concrete_end
